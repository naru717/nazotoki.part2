<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>è¬è§£ãã‚¢ãƒ—ãƒªç¬¬ï¼’å¼¾ï¼šTMCï¼ˆã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰ã¨ã¯</title>
<style>
  :root{
    --bg:#fff7fb; --card:#ffffff; --text:#2a2a2a; --muted:#6b7280;
    --accent:#ff7ac6; --ok:#16a34a; --ng:#ef4444; --ring:#ffd5ec;
    --gold:#ffcc66; --spark:#fff2a8;
  }
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#fff7fb 0%, #f5fbff 100%);
    color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    -webkit-tap-highlight-color:transparent;
  }
  .wrap{max-width:900px; margin:0 auto; padding:20px 16px 64px;}
  header{display:flex; align-items:center; gap:12px; margin:6px 0 10px;}
  header h1{font-size:26px; margin:0;}
  .mascot{width:40px; height:40px; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.08);}
  .card{background:var(--card); border-radius:20px; box-shadow:0 10px 24px rgba(255,122,198,.15);
        padding:18px; margin:14px 0; border:2px solid var(--ring);}
  .question{font-size:20px; font-weight:700; margin:8px 0 4px;}
  .lead{color:var(--muted); margin-top:2px;}
  .choices{display:grid; gap:10px; margin-top:12px;}
  .choice-btn{width:100%; text-align:left; padding:14px 16px; border-radius:16px; border:2px solid #e7f2ff; background:#fff; cursor:pointer; font-size:16px;}
  .choice-btn:hover{border-color:#cfe7ff; background:#f7fbff;}
  .result{margin-top:10px; font-weight:800; font-size:18px;}
  .ok{color:var(--ok);} .ng{color:var(--ng);}
  .subtitle{font-weight:800; color:#1f2937; margin:6px 0 10px; font-size:18px;}
  .muted-box{background:#fff5fa; border:2px dashed #ffd2ea; padding:10px 12px; border-radius:14px; color:#374151;}
  .explain{margin-top:12px; text-align:left; background:#f7fbff; border:2px solid #dbeafe; border-radius:14px; padding:12px;}
  .fade{animation:fade .25s ease;}
  @keyframes fade{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  @media (max-width:560px){
    header h1{font-size:22px}
    .question{font-size:18px}
    .choice-btn{font-size:15px; padding:14px}
    .btn{width:100%}
  }

  /* ãƒœã‚¿ãƒ³ */
  .btn{
    display:inline-block; padding:14px 18px; border-radius:16px; border:none; cursor:pointer; font-size:16px;
    background:linear-gradient(90deg,var(--accent),#ffa7d8); color:#fff; box-shadow:0 8px 18px rgba(255,122,198,.35);
  }
  .btn:disabled{opacity:.6; cursor:not-allowed;}
  .btn.alt{background:linear-gradient(90deg,#8ec5ff,#b5e1ff);}
  .btn.ghost{ background:#fff; color:#ff4fae; border:2px solid #ffb4df; box-shadow:none; }

  /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆç¸¦ä¸¦ã³ï¼‰ */
  .form-vertical{display:flex; flex-direction:column; gap:12px;}
  label{font-size:14px; color:#6b7280; margin-bottom:6px;}
  input{
    width:100%; padding:14px 14px; font-size:16px; border-radius:14px; border:2px solid #ffdff0; background:#fff; outline:none;
  }
  input:focus{border-color:#ffb3dc; box-shadow:0 0 0 4px #ffe6f4;}

  /* ãƒ’ãƒ¼ãƒ­ãƒ¼ï¼ˆç´¹ä»‹ï¼‰ */
  .hero{
    display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px;
  }
  .hero img{ width:min(68vw, 300px); height:auto; border-radius:24px; box-shadow:0 10px 26px rgba(0,0,0,.12); }
  .speech{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:18px; padding:12px 14px; line-height:1.7;
    position:relative; max-width:680px;
  }
  .speech:after{
    content:""; position:absolute; top:100%; left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffd5ec;
  }
  .speech:before{
    content:""; position:absolute; top:calc(100% + 2px); left:50%; transform:translateX(-50%);
    border:10px solid transparent; border-top-color:#ffffff;
  }

  /* æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— */
  .stamp{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(255,255,255,.75); z-index:50;}
  .stamp img{width:min(70vw,380px); height:auto; filter:drop-shadow(0 10px 24px rgba(0,0,0,.2)); animation:pop .5s ease;}
  @keyframes pop{0%{transform:scale(.6) rotate(-6deg); opacity:0}60%{transform:scale(1.05) rotate(2deg); opacity:1}100%{transform:scale(1) rotate(0)}}

  /* ===== ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è±ªè¯ç‰ˆ ===== */
  #screen-ending{ position:relative; overflow:hidden; }
  .ending-wrap{ display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; }
  .ending-hero{
    width:min(80vw, 420px); height:auto;
    border-radius:28px; box-shadow:0 18px 40px rgba(255,122,198,.35);
    outline:6px solid rgba(255, 213, 236, .6);
  }
  .ending-title{
    font-size:24px; font-weight:900; letter-spacing:.02em;
    background:linear-gradient(90deg,#ff7ac6,#ffcc66); -webkit-background-clip:text; background-clip:text; color:transparent;
  }
  .ending-lines{
    line-height:1.9; font-size:16px; color:#374151;
    background:#fffef3; border:2px solid #ffefb6; border-radius:16px; padding:10px 14px;
  }
  .ending-badge{
    display:inline-block; padding:8px 12px; border-radius:999px;
    background:linear-gradient(90deg,#ffd591,#ffe9b6); color:#6b4000; font-weight:800; font-size:13px;
    border:1px solid #f6c66f; box-shadow:0 6px 16px rgba(255,204,102,.35);
  }
  .ending-actions{ display:flex; gap:10px; margin-top:6px; flex-wrap:wrap; justify-content:center; }

  /* ç´™å¹é›ª */
  .confetti{ pointer-events:none; position:absolute; inset:0; overflow:hidden; }
  .confetti span{
    position:absolute; top:-10px; width:10px; height:16px; opacity:.9;
    animation:fall 2.8s linear forwards; transform:rotate(0deg);
  }
  @keyframes fall{
    0%{ transform:translateY(-10px) rotate(0deg); }
    100%{ transform:translateY(120vh) rotate(540deg); }
  }
  /* ã‚­ãƒ©ã‚­ãƒ© */
  .sparkles{ pointer-events:none; position:absolute; inset:0; }
  .spark{
    position:absolute; width:10px; height:10px; background:radial-gradient(circle, var(--spark) 0%, rgba(255,255,255,0) 70%);
    animation:blink 1.6s ease-in-out infinite;
  }
  @keyframes blink{ 0%,100%{opacity:0.2} 50%{opacity:1} }

  /* ===== å ã„æ¼”å‡ºï¼ˆçµæœãƒšãƒ¼ã‚¸ï¼‰ ===== */
  .fortune-wrap{
    display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:10px;
  }
  .tarot-hero{
    width:min(62vw, 260px); height:auto; border-radius:22px;
    box-shadow:0 12px 24px rgba(0,0,0,.12);
    outline:4px solid rgba(255,213,236,.6);
  }
  .fortune-lines{
    background:#ffffff; border:2px solid #ffd5ec; border-radius:16px; padding:10px 12px; line-height:1.9;
    min-height:72px; max-width:680px; text-align:left;
  }
  .fortune-line{ opacity:0; transform:translateY(4px); animation:fade .3s ease forwards; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬2ç« ï¼‰" class="mascot" />
      <h1>ç¬¬ï¼’å¼¾TMCï¼ˆã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰ã¨ã¯</h1>
    </header>

    <!-- å…¥åŠ›ç”»é¢ -->
    <section id="screen-intro" class="card fade">
      <div class="hero">
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“ï¼ˆç¬¬2ç« ï¼‰" />
        <div class="speech">
          <strong>ã¼ãã¯ ã¨ã›ã„ãã‚“ã€‚</strong><br>
          <strong>TMC(ã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ã®ãƒã‚¹ã‚³ãƒƒãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã ã‚ˆã€‚ã€‚</strong><br>
          ã‚ãªãŸã®ã“ã¨<strong>æ•™ãˆã¦ï¼</strong>
        </div>
      </div>

      <div style="height:8px;"></div>

      <div class="form-vertical">
        <div>
          <label for="name">åå‰</label>
          <input id="name" type="text" placeholder="ä¾‹ï¼‰ãƒ•ãƒ«ãƒãƒ¼ãƒ " />
        </div>
        <div>
          <label for="group">æ‰€å±</label>
          <input id="group" type="text" placeholder="ä¾‹ï¼‰å¤–æ¥ï¼ã€‡ã€‡ç—…æ£Ÿï¼ãƒªãƒ ãªã©" />
        </div>
        <div>
          <label for="job">è·ç¨®</label>
          <input id="job" type="text" placeholder="ä¾‹ï¼‰çœ‹è­·å¸«ï¼åŒ»å¸«ï¼è–¬å‰¤å¸« ãªã©" />
        </div>
      </div>

      <div style="margin-top:16px;">
        <!-- Safariå¯¾ç­–ï¼šonclickç›´ä»˜ã‘ -->
        <button class="btn" id="go-pre" onclick="goPre()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
    <section id="screen-pre" class="card fade" style="display:none;">
      <div id="pre-title" class="subtitle"></div>
      <div class="muted-box" style="margin:10px 0 14px;">
        ğŸ”® <strong>è¡€æ¶²å‹ã‚ã¦è¨ºæ–­ï¼ˆå…¨3å•ï¼‰</strong><br/>
        ç›´æ„Ÿã§é¸ã¶ã¨ã€ã‚ãªãŸã®â€œã‚¿ã‚¤ãƒ—â€ãŒè¦‹ãˆã¦ãã‚‹ï¼<br/>
        æº–å‚™ã¯ã„ã„ï¼Ÿ ã§ã¯è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆã€‚
      </div>
      <button class="btn alt" id="begin-diag" onclick="beginDiag()">è¨ºæ–­ã‚’ã¯ã˜ã‚ã‚‹</button>
    </section>

    <!-- è¨ºæ–­ï¼ˆ3å•â†’4ã‚¿ã‚¤ãƒ—ï¼‰ -->
    <section id="screen-diag" class="card fade" style="display:none;">
      <div class="question" id="diag-q"></div>
      <div class="choices" id="diag-choices"></div>
      <div class="lead" id="diag-progress" style="margin-top:8px;"></div>
    </section>

    <!-- è¨ºæ–­çµæœï¼ˆå ã„æ¼”å‡ºï¼‰ -->
    <section id="screen-diag-result" class="card fade" style="display:none;">
      <div id="type-title" class="question"></div>
      <div id="type-copy" class="lead"></div>

      <div class="fortune-wrap">
        <img src="mame2.png" alt="ã‚¿ãƒ­ãƒƒãƒˆã‚’æŒã¤ã¨ã›ã„ãã‚“" class="tarot-hero" />
        <div id="fortune-lines" class="fortune-lines"></div>
      </div>

      <ul id="type-desc" style="text-align:left; line-height:1.8;"></ul>
      <div class="muted-box" style="margin-top:12px;">
        ã•ã‚ã€<strong>TMCï¼ˆã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰</strong>ã®ä¸–ç•Œã¸ï¼<br/>
        ã“ã®ã‚¿ã‚¤ãƒ—ã‚’æ´»ã‹ã—ã¦è¬è§£ãã«æŒ‘ã‚‚ã†ã€‚
      </div>
      <button class="btn" id="to-quiz" onclick="toQuiz()" style="margin-top:14px;">ç¬¬1å•ã¸é€²ã‚€</button>
    </section>

    <!-- æœ¬ç·¨Q1ã€œQ3ï¼ˆTMCï¼‰ -->
    <section id="screen-quiz" class="card fade" style="display:none;">
      <div id="story" class="lead" style="margin-bottom:8px;"></div>
      <div style="text-align:center; margin:10px 0;">
        <img id="quiz-img" src="" alt="è¬ã®ç”»åƒ" style="max-width:100%; border-radius:14px; box-shadow:0 4px 12px rgba(0,0,0,0.1);" />
      </div>
      <div id="q-title" class="question"></div>
      <div id="choices" class="choices"></div>
      <div id="judge" class="result"></div>
      <div id="explain" class="explain" style="display:none;"></div>
      <div id="next-area" style="display:none; margin-top:12px;">
        <button id="next-btn" class="btn" onclick="goNext()">æ¬¡ã¸</button>
      </div>
    </section>

    <!-- ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚° -->
    <section id="screen-ending" class="card fade" style="display:none;">
      <div class="ending-wrap">
        <div class="ending-title">ğŸ‰ ã‚¯ãƒªã‚¢ãŠã‚ã§ã¨ã†ï¼ï¼ˆç¬¬2ç« ï¼‰</div>
        <img src="mame2.png" alt="ã¨ã›ã„ãã‚“" class="ending-hero" />
        <div class="ending-lines">
          <div class="ending-badge">ã¨ã†ã›ã„ã®è¬ãƒ»åæ¢åµèªå®š</div>
          <div id="ending-text" style="margin-top:6px;"></div>
          <div style="margin-top:6px;">
            ã‚ãªãŸã¯<strong>TMCï¼ˆã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ï¼‰</strong> ã«ãµã•ã‚ã—ã„åæ¢åµğŸ†âœ¨<br>
            TMCã®ã“ã¨ã§èããŸã„ã“ã¨ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚PHS6693ã«é€£çµ¡ã—ã¦ã­ã€‚
          </div>
        </div>
        <div class="ending-actions">
          <button class="btn ghost" id="finish-btn">ä»Šå›ã®èª¿æŸ»ã‚’çµ‚äº†ã™ã‚‹</button>
        </div>
        <div id="finish-message" style="display:none; margin-top:10px; font-weight:800; color:#374151;">
          ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
        </div>
      </div>
      <div class="confetti" id="confetti"></div>
      <div class="sparkles" id="sparkles"></div>
    </section>
  </div>

  <!-- æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ— -->
  <div id="stamp" class="stamp" aria-hidden="true">
    <img src="nazotoki2.png" alt="æ­£è§£ã‚¹ã‚¿ãƒ³ãƒ—" />
  </div>

  <!-- ã‚µã‚¦ãƒ³ãƒ‰ -->
  <audio id="bgm" src="nazotoki2.mp3" preload="none" loop></audio>
  <audio id="seClick" src="pochi.mp3" preload="auto"></audio>
  <audio id="seCorrect" src="pinpon.mp3" preload="auto"></audio>
  <audio id="seClear" src="seikou.mp3" preload="auto"></audio>

<script>
  /* =========================
     Googleãƒ•ã‚©ãƒ¼ãƒ  è¨­å®šï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼‰
     å¾Œã§å®Ÿå€¤ã«å·®ã—æ›¿ãˆã¦ãã ã•ã„
     ========================= */
  const GOOGLE_FORM_ACTION = ""; // TODO: formResponse ã®URL
  const ENTRY_NAME = "";         // TODO: entry.xxxxxï¼ˆåå‰ï¼‰
  const ENTRY_DEPT = "";         // TODO: entry.xxxxxï¼ˆæ‰€å±ï¼‰
  const ENTRY_JOB  = "";         // TODO: entry.xxxxxï¼ˆè·ç¨®ï¼‰

  function sendToGoogleForm({ name, dept, job }) {
    try {
      if (!GOOGLE_FORM_ACTION || !ENTRY_NAME || !ENTRY_DEPT || !ENTRY_JOB) return;
      const fd = new FormData();
      fd.append(ENTRY_NAME, name || "");
      fd.append(ENTRY_DEPT, dept || "");
      fd.append(ENTRY_JOB,  job  || "");
      fetch(GOOGLE_FORM_ACTION, { method: "POST", body: fd, mode: "no-cors" })
        .then(function(){ console.log("âœ… Googleãƒ•ã‚©ãƒ¼ãƒ ã«é€ä¿¡ã—ã¾ã—ãŸ"); })
        .catch(function(e){ console.warn("âš ï¸ é€ä¿¡ã‚¨ãƒ©ãƒ¼:", e); });
    } catch (e) { console.warn("âš ï¸ é€ä¿¡ä¾‹å¤–:", e); }
  }

  // ===== DOM =====
  const nameEl  = document.getElementById('name');
  const groupEl = document.getElementById('group');
  const jobEl   = document.getElementById('job');

  const screenIntro = document.getElementById('screen-intro');
  const screenPre   = document.getElementById('screen-pre');
  const screenDiag  = document.getElementById('screen-diag');
  const screenDiagResult = document.getElementById('screen-diag-result');
  const screenQuiz  = document.getElementById('screen-quiz');
  const screenEnding= document.getElementById('screen-ending');

  const preTitle = document.getElementById('pre-title');
  const stampEl = document.getElementById('stamp');

  const diagQEl = document.getElementById('diag-q');
  const diagChoicesEl = document.getElementById('diag-choices');
  const diagProgEl = document.getElementById('diag-progress');

  const storyEl = document.getElementById('story');
  const qTitleEl = document.getElementById('q-title');
  const choicesEl = document.getElementById('choices');
  const judgeEl = document.getElementById('judge');
  const explainEl = document.getElementById('explain');
  const nextArea = document.getElementById('next-area');
  const nextBtn  = document.getElementById('next-btn');
  const endingText = document.getElementById('ending-text');
  const quizImgEl = document.getElementById('quiz-img');
  const confettiEl = document.getElementById('confetti');
  const sparklesEl = document.getElementById('sparkles');

  const fortuneLinesEl = document.getElementById('fortune-lines');
  const finishBtn = document.getElementById('finish-btn');
  const finishMessage = document.getElementById('finish-message');

  // ===== Sound =====
  const bgm = document.getElementById('bgm');
  const seClick = document.getElementById('seClick');
  const seCorrect = document.getElementById('seCorrect');
  const seClear = document.getElementById('seClear');
  let bgmStarted = false;

  function playClick(){ try{ seClick.currentTime = 0; seClick.play(); }catch(e){} }
  function playCorrect(){ try{ seCorrect.currentTime = 0; seCorrect.play(); }catch(e){} }
  function ensureBGM(){
    if(!bgmStarted){
      bgmStarted = true;
      try{ bgm.volume = 0.8; bgm.play(); }catch(e){}
    }
  }
  function stopAllSounds(){
    try{ bgm.pause(); bgm.currentTime = 0; }catch(e){}
    try{ seClick.pause(); seClick.currentTime = 0; }catch(e){}
    try{ seCorrect.pause(); seCorrect.currentTime = 0; }catch(e){}
    try{ seClear.pause(); seClear.currentTime = 0; }catch(e){}
    bgmStarted = false;
  }

  // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã§ã‚¯ãƒªãƒƒã‚¯éŸ³ï¼ˆé¸æŠè‚¢ã¯é™¤å¤–ï¼‰
  document.addEventListener('click', function(e){
    const btn = e.target.closest('button');
    if (!btn) return;
    if (btn.classList.contains('choice-btn')) return;
    playClick();
  }, true);

  // ç”»é¢åˆ‡æ›¿
  function hideAll(){ [screenIntro,screenPre,screenDiag,screenDiagResult,screenQuiz,screenEnding].forEach(function(el){ el.style.display='none'; }); }
  function show(el){ hideAll(); el.style.display='block'; window.scrollTo({top:0, behavior:'smooth'}); }
  show(screenIntro);

  // ====== Safariå¯¾ç­–ï¼šonclickç›´ä»˜ã‘ç”¨ã®å…¬é–‹é–¢æ•° ======
  window.goPre = function(){
    if(!nameEl.value.trim()){ nameEl.focus(); nameEl.style.borderColor='#ff8dc7'; return; }
    nameEl.style.borderColor='#ffdff0';
    preTitle.textContent = "ç¬¬2å¼¾ã€TMCã¨ã¯ï¼Ÿã€ã¸ã‚ˆã†ã“ãã€" + nameEl.value + "ã•ã‚“ã€‚ã¾ãšã¯åƒ•ãŒã‚ãªãŸã®æ€§æ ¼ã‚’è¦‹ã¦è¡€æ¶²å‹è¨ºæ–­ã™ã‚‹ã­ï¼";
    show(screenPre);
    sendToGoogleForm({ name: nameEl.value, dept: groupEl.value, job: jobEl.value });
  };

  window.beginDiag = function(){
    ensureBGM();
    diagIndex = 0; diagCounts = {A:0,B:0,O:0,AB:0}; lastPick = null;
    renderDiag(); show(screenDiag);
  };

  window.toQuiz = function(){
    quizIndex = 0;
    renderQuiz();
    show(screenQuiz);
  };

  window.goNext = function(){
    quizIndex++;
    if(quizIndex < quiz.length){
      renderQuiz();
      window.scrollTo({top:0, behavior:'smooth'});
    }else{
      const nm = (nameEl.value || "åæ¢åµ").trim();
      endingText.innerHTML = "<strong>"+ nm +"ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ï¼</strong><br>ã‚¿ã‚¤ãƒ—è¨ºæ–­ã‚‚TMCã®å­¦ã³ã‚‚ã€æ¬¡ã«æ´»ã‹ã—ã¦ã„ã“ã†ã€‚";
      show(screenEnding);
      launchConfetti();
      launchSparkles();
      try{ seClear.currentTime = 0; seClear.play(); }catch(e){}
      window.scrollTo({top:0, behavior:'smooth'});
    }
  };

  // ===== è¡€æ¶²å‹ã‚ã¦è¨ºæ–­ï¼ˆ3å•ï¼‰ =====
  const diagData = [
    { q:"è³ªå•1ï½œåˆå¯¾é¢ã®æ‰“ã¡åˆã‚ã›ã€ã‚ãªãŸã¯ã©ã†å‹•ãï¼Ÿ",
      choices:[
        {label:"äº‹å‰ã«è­°é¡Œã‚’ç¢ºèªã—ã€è­°äº‹ãƒ¡ãƒ¢ã®æ‹…å½“ã‚’ã‹ã£ã¦å‡ºã‚‹", type:"A"},
        {label:"ã¾ãšå ´ã‚’å’Œã¾ã›ã€å…¨å“¡ã®ç™ºè¨€ã‚’å¼•ãå‡ºã™", type:"O"},
        {label:"æ°—ã«ãªã£ãŸç‚¹ã‚’ã‚¹ãƒ”ãƒ¼ãƒ‡ã‚£ãƒ¼ã«ææ¡ˆãƒ»å®Ÿè¡Œã¸", type:"B"},
        {label:"å…¨ä½“ã‚’ä¿¯ç°ã—ã¤ã¤ç‹¬è‡ªã®è¦–ç‚¹ã§ä»£æ›¿æ¡ˆã‚‚ç”¨æ„", type:"AB"}
      ]},
    { q:"è³ªå•2ï½œä»•äº‹ã§äºˆå®šå¤–ã®ãƒˆãƒ©ãƒ–ãƒ«ç™ºç”Ÿï¼ã‚ãªãŸã¯ã©ã†ã™ã‚‹ï¼Ÿ",
      choices:[
        {label:"äº‹å®Ÿç¢ºèªâ†’å„ªå…ˆåº¦ã‚’ä»˜ã‘ã¦æ•´ç†ã™ã‚‹", type:"A"},
        {label:"é–¢ä¿‚è€…ã«å£°ã‚’ã‹ã‘ã¦é€£æºã‚’çµ„ã‚€", type:"O"},
        {label:"è©¦ã›ã‚‹è§£æ±ºç­–ã‚’è¡Œã„åå¿œã‚’è¦‹ã‚‹", type:"B"},
        {label:"ä»®èª¬ã‚’ç«‹ã¦ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¯”è¼ƒã€æœ€é©ãƒ«ãƒ¼ãƒˆã‚’æ±ºã‚ã‚‹", type:"AB"}
      ]},
    { q:"è³ªå•3ï½œè‡ªåˆ†ã‚’ä¸€è¨€ã§è¡¨ã™ãªã‚‰ï¼Ÿ",
      choices:[
        {label:"ä¸å¯§ã§ã¾ã˜ã‚ã€æŠœã‘æ¼ã‚ŒãŒå°‘ãªã„", type:"A"},
        {label:"è‡ªç”±ã§è¡Œå‹•çš„ã€åˆ‡ã‚Šè¾¼ã¿éšŠé•·", type:"B"},
        {label:"ãŠãŠã‚‰ã‹ã§é¢å€’è¦‹ãŒã‚ˆã„ã€èª¿æ•´å½¹", type:"O"},
        {label:"ç›´æ„Ÿã¨è«–ç†ã®äºŒåˆ€æµã€æŸ”è»Ÿ", type:"AB"}
      ]}
  ];
  let diagIndex=0, diagCounts={A:0,B:0,O:0,AB:0}, lastPick=null;

  function renderDiag(){
    const d = diagData[diagIndex];
    diagQEl.textContent = d.q;
    diagChoicesEl.innerHTML = "";
    d.choices.forEach(function(ch){
      const b = document.createElement('button');
      b.className = 'choice-btn';
      b.textContent = ch.label;
      b.onclick = function(){
        diagCounts[ch.type]++; lastPick = ch.type;
        if(++diagIndex < diagData.length) renderDiag(); else showTypeResult();
      };
      diagChoicesEl.appendChild(b);
    });
    diagProgEl.textContent = "(" + (diagIndex+1) + " / " + d.choices.length + ")";
  }

  // å°è©ã‚’1è¡Œãšã¤è¡¨ç¤º
  function renderFortune(lines){
    fortuneLinesEl.innerHTML = "";
    let i = 0;
    (function next(){
      if(i >= lines.length) return;
      const div = document.createElement('div');
      div.className = 'fortune-line';
      div.textContent = lines[i++];
      fortuneLinesEl.appendChild(div);
      setTimeout(next, 900);
    })();
  }

  function showTypeResult(){
    // æœ€é »ã‚¿ã‚¤ãƒ—ã€‚ã‚¿ã‚¤ã¯æœ€å¾Œã®é¸æŠã‚’å„ªå…ˆ
    const order = ["A","B","O","AB"];
    let max = -1, tied=[];
    order.forEach(function(k){
      const v = diagCounts[k];
      if(v > max){ max = v; tied=[k]; }
      else if(v === max){ tied.push(k); }
    });
    const main = tied.indexOf(lastPick) !== -1 ? lastPick : tied[0];

    const types = {
      A: {
        label: "Aå‹ã‚¿ã‚¤ãƒ—",
        copy: "å‡ å¸³é¢ã§å …å®Ÿã€‚æº–å‚™ã¨è¨˜éŒ²ã§ãƒãƒ¼ãƒ ã«å®‰å¿ƒã‚’ã‚‚ãŸã‚‰ã™ã€‚",
        lines: [
          "ã¨ã›ã„ãã‚“ã®å ã„çµæœã¯â€¦â€¦",
          "ã‚ãªãŸã¯â€¦â€¦â€¦â€¦ Aå‹ã‚¿ã‚¤ãƒ—ï¼ï¼",
          "æ®µå–ã‚ŠåŠ›ã¨æ­£ç¢ºã•ãŒæœ€å¤§ã®æ­¦å™¨ã ã­ã€‚",
          "å½“ãŸã£ãŸã‹ãªï¼Ÿ"
        ],
        tips: [
          "ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå…±æœ‰ã§æŠœã‘æ¼ã‚Œã‚¼ãƒ­ã¸",
          "æ¡ç‚¹è¦³ç‚¹ã‚’å†’é ­ã§åˆæ„ã—ã¦è¿·ã„ã‚’æ¸›ã‚‰ã™"
        ]
      },
      B: {
        label: "Bå‹ã‚¿ã‚¤ãƒ—",
        copy: "è‡ªç”±ã§æ©Ÿå‹•åŠ›æŠœç¾¤ã€‚æ–°ãƒ«ãƒ¼ãƒˆã®é–‹æ‹“è€…ã€‚",
        lines: [
          "ã¨ã›ã„ãã‚“ã®å ã„çµæœã¯â€¦â€¦",
          "ã‚ãªãŸã¯â€¦â€¦â€¦â€¦ Bå‹ã‚¿ã‚¤ãƒ—ï¼ï¼",
          "ã‚¹ãƒ”ãƒ¼ãƒ‰ã¨è¡Œå‹•åŠ›ã§ãƒãƒ£ãƒ³ã‚¹ã‚’åºƒã’ã‚‹ï¼",
          "å½“ãŸã£ãŸã‹ãªï¼Ÿ"
        ],
        tips: [
          "ä¸€æ¬¡æƒ…å ±ã‚’ç´ æ—©ãå–ã‚Šã«ã„ãå½¹ã‚’æ‹…å½“",
          "ç‹¬èµ°ã—ãªã„ã‚ˆã†è¦ç‚¹ã®è¨€èªåŒ–ã‚’å¿˜ã‚Œãšã«"
        ]
      },
      O: {
        label: "Oå‹ã‚¿ã‚¤ãƒ—",
        copy: "åŒ…å®¹åŠ›ã¨èª¿æ•´åŠ›ã€‚å…¨ä½“æœ€é©ã§æ¨é€²ã™ã‚‹ã‚­ãƒ£ãƒ—ãƒ†ãƒ³ã€‚",
        lines: [
          "ã¨ã›ã„ãã‚“ã®å ã„çµæœã¯â€¦â€¦",
          "ã‚ãªãŸã¯â€¦â€¦â€¦â€¦ Oå‹ã‚¿ã‚¤ãƒ—ï¼ï¼",
          "å ´ã‚’æ•´ãˆã€çš†ã®åŠ›ã‚’å¼•ãå‡ºã™é”äººï¼",
          "å½“ãŸã£ãŸã‹ãªï¼Ÿ"
        ],
        tips: [
          "è©°ã¾ã‚Šã®å¯ŸçŸ¥â†’ãƒªãƒªãƒ¼ãƒ•é…ç½®ã§æµã‚Œã‚’ä½œã‚‹",
          "æœ€çµ‚ç¢ºèªï¼ˆå®‰å…¨ãƒ»å€«ç†ãƒ»èª¬æ˜ï¼‰æ‹…å½“ã‚‚â—"
        ]
      },
      AB: {
        label: "ABå‹ã‚¿ã‚¤ãƒ—",
        copy: "ç›´æ„ŸÃ—è«–ç†ã®äºŒåˆ€æµã€‚çŠ¶æ³ã«å¿œã˜ãŸæœ€å–„æ‰‹ã‚’é¸ã¶ã€‚",
        lines: [
          "ã¨ã›ã„ãã‚“ã®å ã„çµæœã¯â€¦â€¦",
          "ã‚ãªãŸã¯â€¦â€¦â€¦â€¦ ABå‹ã‚¿ã‚¤ãƒ—ï¼ï¼",
          "å¤šé¢çš„ã«è€ƒãˆã¦ä¸€æ­©å…ˆã‚’èª­ã‚€æˆ¦ç•¥å®¶ï¼",
          "å½“ãŸã£ãŸã‹ãªï¼Ÿ"
        ],
        tips: [
          "æ›–æ˜§ã•ã¯â€œå®‰å…¨å´ã«å€’ã™â€åˆå›³ã‚’å…±æœ‰",
          "é¸æŠè‚¢ã‚’2ã€œ3ã«çµã£ã¦åˆæ„å½¢æˆã‚’æ—©ã‚ã‚‹"
        ]
      }
    };

    const t = types[main];
    document.getElementById('type-title').textContent = "ã‚ãªãŸã¯â€¦ " + t.label + "ï¼";
    document.getElementById('type-copy').textContent  = t.copy;

    const ul = document.getElementById('type-desc');
    ul.innerHTML = "";
    t.tips.forEach(function(txt){
      const li=document.createElement('li'); li.textContent=txt; ul.appendChild(li);
    });

    show(screenDiagResult);
    setTimeout(function(){ renderFortune(t.lines); }, 80);
  }

  // ===== æœ¬ç·¨ï¼ˆTMC 3å•ï¼‰ =====
  const quiz = [
    {
      story: "ğŸ” è¬1ï¼šTMCã¨ã¯ï¼Ÿ<br>TMCã¯ã€ã¨ã†ã›ã„ãƒ¡ãƒ‡ã‚£ã‚«ãƒ«ã‚«ãƒƒãƒ—ã€ã®ç•¥ã€‚ã“ã‚Œã¯é™¢å†…ã®å¤šè·ç¨®ãƒãƒ¼ãƒ ãŒå­¦ã³åˆã†ã‚¤ãƒ™ãƒ³ãƒˆã€‚ã§ã¯ã€ãã®ä¸»ãªç‹™ã„ã¯ï¼Ÿ",
      title: "æœ€ã‚‚é©åˆ‡ãªã‚‚ã®ã‚’é¸ã¼ã†ã€‚",
      choices: [
        {label:"éƒ¨ç½²ã”ã¨ã®å‹æ•—ã§äºˆç®—é…åˆ†ã‚’æ±ºã‚ã‚‹", correct:false},
        {label:"å¤šè·ç¨®ãŒå”åŠ›ã—ã¦â€œé€£æºåŠ›ãƒ»å¯¾å¿œåŠ›â€ã‚’é«˜ã‚ã‚‹å­¦ç¿’ã‚¤ãƒ™ãƒ³ãƒˆ", correct:true},
        {label:"å€‹äººã®æŠ€èƒ½ã ã‘ã‚’ç«¶ã†ã‚³ãƒ³ãƒ†ã‚¹ãƒˆ", correct:false},
        {label:"ç—…é™¢å¤–PRãŒç¬¬ä¸€ç›®çš„ã®åºƒå ±ã‚¤ãƒ™ãƒ³ãƒˆ", correct:false}
      ],
      explain: [
        "TMCã¯â€œãƒãƒ¼ãƒ ã§ã®å­¦ã³â€ãŒä¸»è»¸ã€‚",
        "å¤šè·ç¨®é€£æºãƒ»å®‰å…¨æ„è­˜ãƒ»èª¬æ˜ã®ã‚ã‹ã‚Šã‚„ã™ã•ãªã©ã‚’ç£¨ãã€‚",
        "ã“ã‚Œã¯å‡ºã‚‹ã¨ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šãã†ã ï¼ï¼"
      ]
    },
    {
      story: "ğŸ§© è¬2ï¼šæœ€é©ãƒãƒ¼ãƒ ã¨ã¯ï¼Ÿ<br>å®Ÿéš›ã®ç¾å ´ã«è¿‘ã„é€£æºã‚’é›ãˆã‚‹ã«ã¯ã€ã©ã‚“ãªãƒãƒ¼ãƒ ç·¨æˆãŒæœ›ã¾ã—ã„ï¼Ÿ",
      title: "æ­£ã—ã„ã‚‚ã®ã‚’é¸ã¼ã†ã€‚",
      choices: [
        {label:"åŒä¸€è·ç¨®ã®ã¿ã§å›ºã‚ã‚‹", correct:false},
        {label:"çœ‹è­·ãƒ»åŒ»å¸«ãƒ»ãƒªãƒãƒ»è–¬å‰¤ãƒ»äº‹å‹™ãªã©å¤šè·ç¨®ãŒæ··åœ¨", correct:true},
        {label:"çµŒé¨“å¹´æ•°ã®è¿‘ã„äººã ã‘ã§çµ„ã‚€", correct:false},
        {label:"è³‡æ ¼ã®å¤šã„äººã ã‘ã§æ§‹æˆã™ã‚‹", correct:false}
      ],
      explain: [
        "å¤šæ§˜æ€§ãŒæ„æ€æ±ºå®šã®è³ªã‚’é«˜ã‚ã‚‹ã€‚",
        "æƒ…å ±ã®å¤šè§’åŒ–ï¼†ç›¸äº’è£œå®ŒãŒå®Ÿåœ°ã«è¿‘ã„é€£æºã‚’ç”Ÿã‚€ã€‚"
      ]
    },
    {
      story: "ğŸ›¡ï¸ è¬3ï¼šè¿·ã£ãŸæ™‚ã®å„ªå…ˆé †ä½<br>TMCå½“æ—¥ã€å›°é›£ãªèª²é¡Œã«ç›´é¢ã€‚ä½•ã‚’æœ€å„ªå…ˆã«ã™ã¹ãï¼Ÿ",
      title: "æœ€ã‚‚é©åˆ‡ãªå¯¾å¿œã‚’é¸ã¼ã†ã€‚",
      choices: [
        {label:"æ­£è§£ã‚’æ—©ãå‡ºã™ãŸã‚ã€ã¾ãšå£°ã®å¤§ãã„äººã«ä»»ã›ã‚‹", correct:false},
        {label:"å®‰å…¨ãƒ»å€«ç†ãƒ»èª¬æ˜ã®å¦¥å½“æ€§ã‚’ç¢ºèªã—ã€å¿…è¦ãªã‚‰ãƒ˜ãƒ«ãƒ—è¦è«‹", correct:true},
        {label:"ä¸€åº¦æ±ºã‚ãŸå½¹å‰²ã‚’å´©ã•ãšå®Œé‚ã™ã‚‹", correct:false},
        {label:"æ¡ç‚¹åŸºæº–ã¨ç„¡é–¢ä¿‚ã§ã‚‚â€œé¢ç™½ã•â€ã‚’å„ªå…ˆ", correct:false}
      ],
      explain: [
        "å®‰å…¨ç¬¬ä¸€ã€‚è¿·ã£ãŸã‚‰å®‰å…¨å´ã«å€’ã™ã®ãŒé‰„å‰‡ã€‚",
        "å¿…è¦æ™‚ã¯ãƒ˜ãƒ«ãƒ—ãƒ»ä¸Šé•·é€£çµ¡ãƒ»è¨˜éŒ²ã‚’é©åˆ‡ã«ã€‚"
      ]
    }
  ];
  let quizIndex = 0;
  const quizImages = ["nazo4.png","nazo5.png","nazo6.png"]; // ä»»æ„ç”»åƒï¼ˆç„¡ã‘ã‚Œã°ç©ºã§ã‚‚OKï¼‰

  function renderQuiz(){
    const q = quiz[quizIndex];
    storyEl.innerHTML = q.story;
    quizImgEl.src = quizImages[quizIndex] || "";
    quizImgEl.alt = "ç¬¬" + (quizIndex+1) + "ã®è¬";

    qTitleEl.textContent = q.title;
    choicesEl.innerHTML = ""; judgeEl.textContent = "";
    explainEl.style.display = "none"; explainEl.innerHTML = "";
    nextArea.style.display = "none";

    q.choices.forEach(function(c){
      const b = document.createElement('button');
      b.className = 'choice-btn';
      b.textContent = c.label;
      b.onclick = function(){ judge(c.correct); };
      choicesEl.appendChild(b);
    });
  }

  function showStamp(){
    stampEl.style.display = 'flex';
    setTimeout(function(){ stampEl.style.display = 'none'; }, 700);
  }

  // ä¸€ç™ºæ­£è§£æ–¹å¼ï¼ˆæ¡ç‚¹è¡¨ç¤ºãªã—ï¼æ­£è§£ã§ãƒ”ãƒ³ãƒãƒ³ï¼†ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  function judge(isCorrect){
    if(isCorrect){
      judgeEl.textContent = "æ­£è§£ï¼";
      judgeEl.className = "result ok";

      try{ seClick.pause(); seClick.currentTime = 0; }catch(e){}
      try{
        seCorrect.currentTime = 0;
        setTimeout(function(){ try{ seCorrect.play(); }catch(e){} }, 30);
      }catch(e){}

      showStamp();

      const q = quiz[quizIndex];
      explainEl.innerHTML = "<strong>è§£èª¬</strong><ul style='margin:6px 0 0; padding-left:18px;'>" +
        q.explain.map(function(t){ return "<li>"+ t +"</li>"; }).join("") + "</ul>";
      explainEl.style.display = "block";
      nextArea.style.display = "block";

    }else{
      judgeEl.textContent = "æ®‹å¿µï¼ã‚‚ã†ä¸€åº¦é¸ã‚“ã§ã¿ã‚ˆã†ã€‚";
      judgeEl.className = "result ng";
    }
  }

  // ç´™å¹é›ªï¼†ã‚­ãƒ©ã‚­ãƒ©
  function launchConfetti(){
    confettiEl.innerHTML = "";
    const colors = ["#ff7ac6","#ffd166","#7bdff2","#c3f0ca","#b5b0ff"];
    for(let i=0;i<40;i++){
      const s = document.createElement('span');
      const size = 8 + Math.random()*10;
      s.style.width = size + "px";
      s.style.height = (size*1.6) + "px";
      s.style.left = (Math.random()*100) + "%";
      s.style.background = colors[Math.floor(Math.random()*colors.length)];
      s.style.animationDelay = (Math.random()*0.8) + "s";
      s.style.opacity = 0.8 + Math.random()*0.2;
      confettiEl.appendChild(s);
    }
  }
  function launchSparkles(){
    sparklesEl.innerHTML = "";
    for(let i=0;i<18;i++){
      const sp = document.createElement('div');
      sp.className = 'spark';
      sp.style.left = (Math.random()*100) + "%";
      sp.style.top  = (Math.random()*100) + "%";
      sp.style.animationDelay = (Math.random()*1.2) + "s";
      sparklesEl.appendChild(sp);
    }
  }

  // çµ‚äº†ãƒœã‚¿ãƒ³
  finishBtn.addEventListener('click', function(){
    stopAllSounds();
    finishMessage.style.display = 'block';
    finishBtn.disabled = true;
    finishBtn.textContent = 'çµ‚äº†ã—ã¾ã—ãŸ';
  });

  // BGMé–‹å§‹ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«
  document.getElementById('begin-diag').addEventListener('click', function(){
    if(!bgmStarted){
      bgmStarted = true;
      try{ bgm.volume = 0.8; bgm.play(); }catch(e){}
    }
  });
</script>
</body>
</html>

